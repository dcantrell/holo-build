# Interface test suite for `holo-build`

This half of the `holo-build` test suite covers the behavior of `holo-build`
under various combinations of the possible command-line options.

All testcases use the same package definition (`input.toml`), because the
output file name shall be predictable.  Each testcase looks like this:

    test/interface/         <-- this directory
        01-minimal/         <-- the directory for the test setup
            run.sh          <-- testcase runner (will run inside the testcase directory)
            stdout          <-- stdout from run.sh (generated by test run)
            stderr          <-- stderr from run.sh (generated by test run)
            expected-stdout <-- what we expect to be in stdout
            expected-stderr <-- what we expect to be in stderr

## Running the tests

To run all the tests, use the make targets `test` or `check` in the top-level
directory. To run just the interfacinterface tests, do:

    bash test/interface/run_tests.sh

To run just some interface tests, give the test names (the directory names below the
`test/holo-build` directory) as arguments:

    bash test/interface/run_tests.sh 01-minimal

The test will usually output just a progress display (one line per test case).
If a test fails, the failing parts will be printed on the command line. To flag
test failure when run in Continuous Integration setups, `run_tests.sh` will
exit with non-zero status when one or more test cases fail.

## Writing new testcases

To build a new testcase, first create the test directory and its `run.sh`.
This file should also contain an explanation of what the testcase checks.

Now run your testcase. It will obviously fail since all the files that it
compares its build results to are missing. But we can use these build results
as basis for the missing files. Copy

    stdout -> expected-stdout
    stderr -> expected-stderr

Before checking these into source control, verify carefully that these files
really contain the *expected* results of the testcase run. When that is done,
your testcase should now pass. Or not, if the code needs fixing. ;)
